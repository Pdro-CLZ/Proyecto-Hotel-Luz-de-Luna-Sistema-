{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Visualizar Estado de Limpieza</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="{% static 'css/estilos.css' %}">
</head>

<body>

  <nav class="navbar">
    <div class="navbar-container">
      <a href="#" class="nav-logo">Mi Empresa</a>
      <ul class="nav-links">
        <li><a href="../Inventario/index.html">Inventario</a></li>
        <li><a href="../Limpieza/index.html">Limpieza</a></li>
        <li><a href="../Administrativo/index.html">Administrativo</a></li>
        <li><a href="../Marketing/index.html">Marketing</a></li>
        <li><a href="../Reservas/index.html">Reservas</a></li>
        <li><a href="../Contabilidad/index.html">Contabilidad</a></li>
        <li><a href="../Reportería/index.html">Reportería</a></li>
      </ul>
      <div class="nav-toggle">&#9776;</div>
    </div>
  </nav>

  <div class="container my-4" id="content">
    <h1 class="titulo-primario mb-4">Estado de Limpieza</h1>

    <a href="{% url 'limpieza:registrar_zona' %}" class="btn btn-personalizado mb-3">
      Registrar Nueva Zona
    </a>


    {% if error %}
    <p style="color:red;">{{ error }}</p>
    {% else %}

    <div class="mb-4">
      <h3 class="titulo-primario mb-4">Buscar Zona</h3>
      <input type="text" id="busqueda" class="form-control" placeholder="Escriba ID o nombre de zona...">

      <select id="resultados" class="form-select mt-2">
        <option value="">-- Seleccione una zona --</option>
      </select>

      <a id="btnActualizar" href="#" class="btn btn-warning mt-2" style="display:none;">
        Ir a Actualizar Zona
      </a>
    </div>

    <table class="table table-bordered">
      <tr>
        <th>Habitación / Zona</th>
        <th>Estado</th>
        <th>Empleado</th>
        <th>Fecha</th>
        <th>Observaciones</th>
        <th>Acciones</th>
      </tr>
      {% for limpieza in limpiezas %}
      <tr>
        <td>{{ limpieza.habitacion }}</td>
        <td>{{ limpieza.estado }}</td>
        <td>{{ limpieza.empleado }}</td>
        <td>{{ limpieza.fecha }}</td>
        <td>{{ limpieza.observaciones }}</td>
        <td>
          <a href="{% url 'limpieza:registrar_estado' limpieza.habitacion.id %}"
            class="btn btn-personalizado btn-sm">Registrar Estado</a>
          <a href="{% url 'limpieza:visualizar_estado' limpieza.habitacion.id %}"
            class="btn btn-secondary btn-sm">Visualizar Estado</a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6">No hay registros de limpieza disponibles.</td>
      </tr>
      {% endfor %}
    </table>
    {% endif %}

    <div class="text-center">
      <a href="" class="btn btn-personalizado mt-4">Volver</a>
    </div>
  </div>


  <script>
    const navToggle = document.querySelector(".nav-toggle");
    const navbar = document.querySelector(".navbar");

    navToggle.addEventListener("click", () => {
      navbar.classList.toggle("open");
    });


    document.getElementById("busqueda").addEventListener("keyup", function () {
      let query = this.value;
      if (query.length > 0) {
        fetch(`/limpieza/buscar_zona/?q=${query}`)
          .then(response => response.json())
          .then(data => {
            let select = document.getElementById("resultados");
            select.innerHTML = '<option value="">-- Seleccione una zona --</option>';
            data.resultados.forEach(z => {
              let option = document.createElement("option");
              option.value = z.id;
              option.textContent = z.nombre + " (ID: " + z.id + ")";
              select.appendChild(option);
            });
          });
      }
    });

    document.getElementById("resultados").addEventListener("change", function () {
      let id = this.value;
      let btn = document.getElementById("btnActualizar");
      if (id) {
        btn.href = `/limpieza/actualizar_zona/${id}/`;
        btn.style.display = "inline-block";
      } else {
        btn.style.display = "none";
      }
    });

  </script>
</body>

</html>