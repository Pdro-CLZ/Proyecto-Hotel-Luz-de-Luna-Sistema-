{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reporte de Limpieza</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">
<div class="container py-4">
  <h2 class="text-center mb-4"> Reporte de Limpieza de Habitaciones</h2>

  <!--  Filtros -->
  <form method="get" class="row g-3 mb-4">
    <div class="col-md-3">
      <label class="form-label">Habitación</label>
      <select name="habitacion" class="form-select">
        <option value="">Todas</option>
        {% for h in habitaciones %}
          <option value="{{ h.id }}" {% if habitacion_id|default:'' == h.id|stringformat:"s" %}selected{% endif %}>{{ h.nombre }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-3">
  <label class="form-label">Encargado</label>
  <select name="encargado" class="form-select">
    <option value="">Todos</option>
    {% for e in encargados %}
      <option value="{{ e.id }}" {% if encargado_id|default:'' == e.id|stringformat:"s" %}selected{% endif %}>
        {{ e }} 
      </option>
    {% endfor %}
  </select>
</div>


    <div class="col-md-3">
      <label class="form-label">Desde</label>
      <input type="date" name="desde" value="{{ fecha_inicio }}" class="form-control">
    </div>

    <div class="col-md-3">
      <label class="form-label">Hasta</label>
      <input type="date" name="hasta" value="{{ fecha_fin }}" class="form-control">
    </div>

    <div class="col-md-3 d-flex align-items-end">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="pendientes" value="1" {% if mostrar_pendientes %}checked{% endif %}>
        <label class="form-check-label">Mostrar pendientes</label>
      </div>
    </div>

    <div class="col-md-3 mt-2">
      <button class="btn btn-primary w-100">Aplicar Filtros</button>
    </div>

    <div class="col-md-3 mt-2 text-end">
      <a href="?exportar=excel" class="btn btn-success w-100 mb-2"> Exportar Excel</a>
      <a href="?exportar=pdf" class="btn btn-danger w-100"> Exportar PDF</a>
    </div>
  </form>

  <!--  Tabla Historial -->
  <h5>Historial de Limpieza</h5>
  <table class="table table-striped table-sm">
    <thead>
      <tr>
        <th>Habitación</th>
        <th>Tarea</th>
        <th>Empleado</th>
        <th>Estado</th>
        <th>Fecha modificación</th>
      </tr>
    </thead>
    <tbody>
      {% for t in tareas %}
      <tr>
        <td>{{ t.zona.nombre }}</td>
        <td>{{ t.nombre }}</td>
        <td>{{ t.usuario_modifica.username|default:"—" }}</td>
        <td>{{ t.estado }}</td>
        <td>{{ t.fecha_modificacion|date:"Y-m-d H:i" }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="5" class="text-center text-muted">Sin registros</td></tr>
      {% endfor %}
    </tbody>
  </table>

</div>
</body>
</html>
