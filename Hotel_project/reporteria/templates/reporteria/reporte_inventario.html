{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reporte de Inventario</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
  <h2 class="text-center mb-4">Reporte de Inventario del Hotel</h2>

  <!-- Filtros -->
  <form method="get" class="row g-3 mb-4">
    <div class="col-md-3">
      <label class="form-label">Tipo de Inventario</label>
      <select name="tipo" class="form-select">
        <option value="">Todos</option>
        <option value="Activo" {% if tipo_filtro == "Activo" %}selected{% endif %}>Activos</option>
        <option value="Insumo" {% if tipo_filtro == "Insumo" %}selected{% endif %}>Insumos</option>
      </select>
    </div>

    <div class="col-md-3 d-flex align-items-end">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="bajo_stock" value="1" {% if bajo_stock %}checked{% endif %}>
        <label class="form-check-label">Mostrar bajo stock (&lt;10)</label>
      </div>
    </div>

    <div class="col-md-3 mt-2">
      <button class="btn btn-primary w-100">Aplicar Filtros</button>
    </div>

    <div class="col-md-3 mt-2 text-end">
      <a href="?exportar=excel" class="btn btn-success w-100 mb-2">Exportar Excel</a>
      <a href="?exportar=pdf" class="btn btn-danger w-100">Exportar PDF</a>
    </div>
  </form>

  <!-- Tabla -->
  <h5>Inventario Actual</h5>
  <table class="table table-striped table-sm">
    <thead>
      <tr>
        <th>Producto</th>
        <th>Descripci√≥n</th>
        <th>Tipo</th>
        <th>Cantidad</th>
        <th>Estado</th>
      </tr>
    </thead>
    <tbody>
      {% for p in productos %}
      <tr {% if p.cantidad < 10 %}class="table-danger"{% endif %}>
        <td>{{ p.nombre }}</td>
        <td>{{ p.descripcion }}</td>
        <td>{{ p.tipo }}</td>
        <td>{{ p.cantidad }}</td>
        <td>{% if p.cantidad < 10 %}<strong>Bajo stock</strong>{% else %}Normal{% endif %}</td>
      </tr>
      {% empty %}
      <tr><td colspan="6" class="text-center text-muted">Sin registros</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Historial -->
  {% if producto_seleccionado %}
  <hr>
  <h5>Historial de movimientos: {{ producto_seleccionado.nombre }}</h5>
  <table class="table table-bordered table-sm">
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Tipo</th>
        <th>Cantidad</th>
        <th>Proveedor</th>
      </tr>
    </thead>
    <tbody>
      {% for h in historial %}
      <tr>
        <td>{{ h.fecha|date:"Y-m-d" }}</td>
        <td>{{ h.tipo }}</td>
        <td>{{ h.cantidad }}</td>
        <td>{{ h.proveedor }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="4" class="text-center text-muted">Sin movimientos registrados</td></tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
</div>
</body>
</html>
